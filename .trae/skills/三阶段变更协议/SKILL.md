---
name: 三阶段变更协议
description: 强制三阶段：阶段1只分析不改动；阶段2论证并确认方案；阶段3收到“确认执行/Proceed”后才改动，并小步提交与自检。
---

# Skill：三阶段变更协议（强制）

## 目标
减少重复修改与大范围改动导致的错误。所有对代码/文件/配置的修改，必须按三阶段进行。

---

## 总规则（全程生效）
1) 默认禁止直接操作：除非我明确说“确认执行 / Proceed / Go”，否则不得修改任何文件、不得运行命令、不得部署、不得生成补丁。
2) 不允许大改：执行阶段必须小步、可回滚，每次只改一个点（一个文件或一个功能点）。
3) 有不确定信息先问：遇到缺失信息/冲突信息，必须先提问或给选项，不允许猜。
4) 每次输出都要结构化：按本技能要求的模板输出，便于我快速确认。
5) 偏离预期立即停：一旦发现实现偏离方案或引入新风险，立刻停止执行，回到阶段2重新论证。

---

## 触发口令（我如何指挥你进入阶段）
- 我说“阶段1/分析” → 只做阶段1
- 我说“阶段2/论证/定案” → 只做阶段2
- 我说“确认执行/Proceed/Go” → 才允许进入阶段3执行

---

## 阶段1：分析与方案（禁止操作）
### 你要做什么
A. 复述我的需求（1-3句）
B. 现状判断（你从我提供的信息中确认了什么？未知什么？）
C. 问题拆解：列出关键子问题/风险点
D. 给出至少2个可行方案（方案A/方案B），每个包含：
   - 变更范围（涉及模块/文件类型）
   - 优点/缺点
   - 风险与回滚思路
E. 需要我确认的点（明确列问题）

### 阶段1输出模板
【阶段1：分析】
- 需求复述：
- 现状与未知：
- 关键风险/约束：
- 方案A：
- 方案B：
- 我需要你确认/补充：
- 下一步建议（进入阶段2需要我说什么）：

【禁止事项】
- 禁止：改代码/改配置/跑命令/部署/生成补丁

---

## 阶段2：论证与定案（仍禁止操作）
### 你要做什么
A. 对比方案（影响范围/复杂度/风险/可回滚性/预计耗时）
B. 推荐最终方案（只能推荐1个）并说明理由
C. 输出“最终变更清单”，必须包含：
   - 具体要改的点（按序号）
   - 可能涉及的文件/目录（若未知就写“待确认”）
   - 测试/自检计划（lint/build/运行方式，若未知提出询问）
   - 回滚方案（如何撤销、如何恢复）
D. 明确“执行口令”：请我回复“确认执行/Proceed”才开始

### 阶段2输出模板
【阶段2：论证与定案】
- 方案对比结论：
- 最终推荐方案：
- 变更清单（按步骤）：
- 测试/自检计划：
- 回滚方案：
- 执行前最后确认点：
- 请回复“确认执行/Proceed/Go”我才开始执行阶段3。

【禁止事项】
- 禁止：改代码/改配置/跑命令/部署/生成补丁

---

## 阶段3：执行（仅在收到确认口令后）
### 执行原则（强制）
1) 一次只做一个小改动点；做完就停下来汇报，不要连改多处。
2) 每一步都输出：
   - 做了什么
   - 改动涉及哪些文件（如能给出 diff 概要更好）
   - 自检结果（命令/结果/报错）
3) 若出现报错/不确定：立刻停止，回到阶段2，给出修复选项让我选。
4) 执行完成后输出最终总结 + 后续建议。

### 阶段3输出模板（每一步）
【阶段3：执行-步骤N】
- 本步目标：
- 本步改动：
- 影响文件：
- 自检/测试：
- 结果与下一步：
（等待我确认是否继续下一步）

【执行完成总结】
- 完成内容：
- 关键改动点：
- 测试结果：
- 回滚方式：
- 待办/优化建议：